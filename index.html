<!DOCTYPE html>
<html>

<head>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-M7CNXDK');</script>
<!-- End Google Tag Manager -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-11759067-12"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-11759067-12');
</script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="description" content="Utah Wetlands">

    <title>Utah Wetlands</title>

    <!-- 00Calcite Maps Bootstrap00 -->
    <link rel="stylesheet" href="https://esri.github.io/calcite-maps/dist/css/calcite-maps-bootstrap.min-v0.10.css">

    <!-- Calcite Maps -->
    <link rel="stylesheet" href="https://esri.github.io/calcite-maps/dist/css/calcite-maps-arcgis-4.x.min-v0.10.css">

    <!-- ArcGIS JS 4 -->
    <link rel="stylesheet" href="https://js.arcgis.com/4.17/esri/css/main.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
        }





        .uppercase {
            text-transform: uppercase;
        }

        .calcite-title:before {
            content: url('https://geology.utah.gov/apps/_ugsmaptemplate/logo_main.png');
            padding: 6px 12px 0 2px;
            cursor: pointer;
        }

        .calcite-title-main a {
            color: #fff;
            font-size: 22px;
            font-weight: 400;
            cursor: pointer;
        }

        .textarea {
            color: #ccc;
            font-family: 'Corbel Regular';
            font-size: 110% !important;
            overflow: auto;
            resize: none;
            width: 98%;
            height: 90px;
            margin: 5px;
            background-color: #515151 !important;
        }

        /* .esri-layer-list__item {
            background-color: #323232;
            border-bottom: 1px solid rgba(50, 50, 50, 0.25);
            color: #fff;
            position: relative;
            overflow: hidden;
            list-style: none;
            margin: 3px 0;
            padding: 0;
        }

        .esri-layer-list__item-actions-menu-item--active {
            background-color: #323232;

        } */

        /* Tooltip container */

        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted #323232;
            /* If you want dots under the hoverable text */
        }

        /* Tooltip text */

        .dropdown-toggle .tooltiptext {
            visibility: hidden;
            width: 120px;
            margin-left: 25px;
            background-color: #636363;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;

            /* Position the tooltip text  */
            position: absolute;
            z-index: 1;
        }

        /* Show the tooltip text when you mouse over the tooltip container */

        .dropdown-toggle:hover .tooltiptext {
            visibility: visible;
        }

    #topbar {
      /* background: #fff; */
      /* position: absolute;
      top: 55px;
      left: 55px; */
      padding: 10px;
    }

    .action-button {
      font-size: 16px;
      background-color: white;
      border: 1px solid #D3D3D3;
      color: #6e6e6e;
      height: 32px;
      width: 32px;
      text-align: center;
      box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
    }

    .action-button:hover,
    .action-button:focus {
      background: #0079c1;
      color: #e4e4e4;
    }

    .active {
      background: #0079c1;
      color: #e4e4e4;
    }

.screenReaderText { 
  border: 0; 
  clip: rect(0 0 0 0); 
  height: 1px; 
  margin: -1px; 
  overflow: hidden; 
  padding: 0; 
  position: absolute; 
  width: 1px; 
}

    </style>

</head>

<body class="calcite-maps calcite-nav-top">

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M7CNXDK"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <a class="ugs-watermark " href="https://geology.utah.gov"></a>
    <!-- Navbar -->

    <nav class="navbar calcite-navbar navbar-fixed-top calcite-text-light calcite-bg-dark">
        <!-- Menu -->
        <div class="dropdown calcite-dropdown calcite-text-dark calcite-bg-light" role="presentation">
            <a class="dropdown-toggle" role="menubutton" aria-haspopup="true" aria-expanded="false" tabindex="0">
                <div id="toolNote" class="tooltiptext">
                    Click for more map tools.
                </div>
                <div class="calcite-dropdown-toggle">
                    <span class="sr-only">Toggle dropdown menu</span>
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </a>
            <ul class="dropdown-menu" role="menu">
                <li><a role="menuitem" tabindex="0" data-target="#panelInfo" aria-haspopup="true"><span class="glyphicon glyphicon-info-sign"></span> About</a></li>
                <li><a role="menuitem" tabindex="0" href="#" data-target="#panelLegend" aria-haspopup="true"><span class="glyphicon glyphicon-list-alt"></span> Legend</a></li>
                <!-- <li><a role="menuitem" tabindex="0" href="#" data-target="#panelLayer" aria-haspopup="true"><span class="glyphicon glyphicon-list"></span> Layer List</a></li> -->
                <li><a role="menuitem" tabindex="0" href="#" data-target="#panelBasemaps" aria-haspopup="true"><span class="esri-icon-basemap"></span> Basemaps</a></li>
                <li><a role="menuitem" tabindex="0" href="#" data-target="#calciteLocate" aria-haspopup="true"><span class="glyphicon glyphicon-map-marker"></span> Locate</a></li>
                <li><a role="menuitem" tabindex="0" data-target="#panelData" aria-haspopup="true"><span class="esri-icon-table"></span> Database Contents</a></li>
                <li><a role="menuitem" tabindex="0" data-target="#panelDownload" aria-haspopup="true"><span class="esri-icon-download"></span> Download Data</a></li>
                <li><a role="menuitem" tabindex="0" data-target="#panelDisc" aria-haspopup="true"><span class="esri-icon-error2"></span> Disclaimer</a></li>
                <li><a role="menuitem" tabindex="0" data-target="#panelRef" aria-haspopup="true"><span class="esri-icon-group"></span> References</a></li>
                <li><a role="menuitem" tabindex="0" href="#" id="calciteToggleNavbar" aria-haspopup="true"><span class="glyphicon glyphicon-fullscreen"></span> Full Map</a></li>
            </ul>
        </div>
        <!-- Title -->
        <div class="calcite-title calcite-overflow-hidden">
            <span class="calcite-title-main">Utah Geological Survey</span>
            <span class="calcite-title-divider hidden-xs"></span>
            <span class="calcite-title-sub hidden-xs">Utah Wetlands</span>
        </div>
        <!-- Nav -->
        <ul class="nav navbar-nav calcite-nav">
            <li>
                <div class="calcite-navbar-search calcite-search-expander">
                    <div id="searchWidgetDiv"></div>
                </div>
            </li>
        </ul>
    </nav>

    <!--/.calcite-navbar -->

    <!-- Map  -->

    <div class="calcite-map calcite-map-absolute">
        <div id="mapViewDiv">
            <!-- <div id="topbar">
                <button class="action-button esri-icon-polygon" id="polygonButton" type="button"
                  title="Draw polygon"></button>
                <button class="action-button esri-icon-down-arrow-circled" id="DownloadButton" type="button"
                  title="Download"></button>

                <button class="action-button esri-icon-trash" id="resetBtn" type="button" title="Clear graphics"></button>
              </div> -->
        </div>
    </div>

    <!-- /.calcite-map -->

    <!-- Panels -->

    <div class="calcite-panels calcite-panels-right calcite-text-light calcite-bg-dark panel-group">

        <!-- Panel - Info -->

        <div id="panelInfo" class="panel collapse in">
            <div id="headingInfo" class="panel-heading" role="tab">
                <div class="panel-title">
                    <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseInfo" aria-expanded="true" aria-controls="collapseInfo"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span><span class="panel-label">About</span></a>
                    <a class="panel-close" role="button" data-toggle="collapse" tabindex="0" href="#panelInfo"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
                </div>
            </div>
            <div id="collapseInfo" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingInfo">
                <div class="panel-body">
                    <p><strong>UTAH WETLANDS</strong></p>
                    <p align="justify"> The Utah Geological Survey (UGS) is part of an ongoing effort to develop a comprehensive, statewide wetland mapping program with the goal of updating spatial data for wetland resources across the state. All Utah wetlands are mapped to National Wetland Inventory (NWI) standards developed by the U.S. Fish and Wildlife Service; however, mapping is not meant to be used as the basis for a jurisdictional wetland delineation. Riparian spatial data are also available for parts of the state where integrated riparian-wetland mapping has occurred. This map contains the most up-to-date NWI data for the state as well as additional information on wetland resources in the state, including links to reports from wetland field assessment studies and distributional data for sensitive amphibian species. See Database Contents for more information on the data in this map.
                    </p>
                    <br>
                    <p><strong>Contact</strong>
                    <p><ul>
                        <li><a href="mailto:dmenuz@utah.gov">Diane Menuz </a>- 801.538.7436</li>
                        </ul></p>
                    <br>
                    <p><strong>Links to Related Information</strong></p>
                    <p><ul>
                        <li><a href="https://geology.utah.gov/resources/wetlands/"><span>Utah Wetland Information Center</span></a><span> for information on wetlands and UGS wetland research</span></li>
                        <li><span><a href="https://www.fws.gov/wetlands/Data/Data-Download.html">National Wetlands Inventory</a> for downloads of the original NWI data</span></li>
                        <li><span><a href="http://www.spk.usace.army.mil/Missions/Regulatory/Contacts/Contact-Your-Local-Office/">U.S. Army Corps of Engineers District Offices</a> for information about wetland regulations and jurisdictional wetland delineations</span></li>
                        </ul></p>
                </div>
            </div>
        </div>

        <!-- Panel - Database -->

        <div id="panelData" class="panel collapse">
            <div id="headingData" class="panel-heading" role="tab">
                <div class="panel-title">
                    <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseData" aria-expanded="true" aria-controls="collapseData"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span><span class="panel-label">Database Contents</span></a>
                    <a class="panel-close" role="button" data-toggle="collapse" tabindex="0" href="#panelData"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
                </div>
            </div>
            <div id="collapseData" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingData">
                <div class="panel-body">
                    <p><strong>BOUNDARIES</strong></p>
                    <p style="padding-left: 30px; text-align: left;"><strong>River basins and subbasins</strong></p>
                    <p style="padding-left: 30px; text-align: left;"><span style="font-weight: 400;">Basins and subbasin watershed boundaries were obtained from the U.S. Geological Survey’s (USGS) 6-digit and 8-digit Hydrologic Unit Code (HUC) boundaries and clipped to the Utah state boundary. </span></p>
                    <p><strong>WETLAND AND RIPARIAN MAPPING</strong></p>
                    <p style="padding-left: 30px; text-align: left;"><strong>Wetland and riparian polygons, wetland outlines, and riverine features</strong></p>
                    <p style="padding-left: 30px; text-align: left;"><i><span style="font-weight: 400;">Wetlands and riparian spatial data were produced from a combination of aerial imagery examination and on-the-ground assessment and are not meant to be used as the basis for a jurisdictional wetland delineation. </span></i><span style="font-weight: 400;">Data are derived from the U.S. Fish and Wildlife Service&rsquo;s </span><a href="https://www.fws.gov/wetlands/"><span style="font-weight: 400;">National Wetlands Inventory</span></a><span style="font-weight: 400;"> (NWI) and are up-to-date as of May 3, 2020. NWI attributes wetlands with codes from the Cowardin Classification System; codes can be interpreted </span><a href="https://www.fws.gov/wetlands/data/wetland-codes.html"><span style="font-weight: 400;">online</span></a><span style="font-weight: 400;">. Polygons mapped as riverine are in a separate layer from other wetland features because of the large size of the data. Riverine features depict predominantly unvegetated habitat contained within a natural or artificial channel. Riparian data depict non-wetland areas along streams, rivers, and lakes that have distinct or distinctly more vigorous vegetation compared to adjacent areas. Mapping follows standards laid out in U.S. Fish and Wildlife Service (2009). Riparian features were mapped in conjuction with wetland features to produce a seamless dataset in the project areas where they were mapped.</span></p>
                    <p style="padding-left: 30px; text-align: left;"><strong>Mapping metadata</strong></p>
                    <p style="padding-left: 30px; text-align: left;"><span style="font-weight: 400;">Metadata are a description of wetland and riparian mapping projects, including the scale at which mapping was conducted and the imagery year used for the mapping. Some mapping projects include supplemental map information that describes the projects in more detail. The riparian metadata also depicts the project boundaries where riparian mapping has occurred. Other wetland mapping projects do not include riparian data.</span></p>
                    <p><strong>HYDRIC SOIL CLASSES</strong></p>
                    <p style="padding-left: 30px; text-align: left;"><span style="font-weight: 400;"></span>The hydric soil classes data were produced by the Natural Resources Consevation Service and depict soils that are saturated for periods of time long enough to create wetland conditions. This data layer is maintained by <a href="https://www.arcgis.com/home/item.html?id=2be45af986af4624839cedae883faf47"><span style="font-weight: 400;">ESRI.</span></a></span></p>
                    <p><strong>WETLAND CONDITION</strong></p>
                    <p style="padding-left: 30px; text-align: left;"><strong>Wetland stressors</strong></p>
                    <p style="padding-left: 30px; text-align: left;"><span style="font-weight: 400;">UGS created a landscape stress model for the state of Utah, focused on stressors likely to impact wetlands, including agriculture, development, hydrologic manipulations, and linear disturbances such as roads and pipelines. See Menuz (2015) for more information on the development of the landscape stress model.</span></p>
                    <p style="padding-left: 30px; text-align: left;"><strong>Wetland assessment projects</strong></p>
                    <p style="padding-left: 30px; text-align: left;"><span style="font-weight: 400;">UGS has conducted field studies to evaluate the condition and potential function of Utah&rsquo;s wetlands. These studies provide baseline information such as the types of wetlands, abundance and severity of common stressors, and rare and common wetland plants in each study area. The wetland assessments project layer shows the boundaries where assessment projects have taken place, with a link to the associated reports when available.</span></p>
                    <p><strong>WETLAND-DEPENDENT SPECIES</strong></p>
                    <p style="padding-left: 30px;"><strong>Sensitive amphibian ranges and habitat</strong></p>
                    <p style="padding-left: 30px;"><span style="font-weight: 400;">County-level data on species&rsquo; ranges were compiled from the Utah Conservation Data Center (2017) and the National Amphibian Atlas (U.S. Geological Survey, 2014). Final presence/absence designations for each county where the two sources disagreed were based on a combination of literature review and best professional judgment. Elevation range and habitat descriptions were developed through consultation with three primary sources (Green and others, 2014; IUCN, 2017; AmphibiaWeb, 2018) and additional literature review.</span></p>
                    <p><strong>LAND OWNERSHIP</strong></p>
                    <p style="padding-left: 30px;"><span style="font-weight: 400;">Land ownership data are maintained by the Bureau of Land Management and the State of Utah School and Institutional Trust Lands Administration and are described in more detail <a href="https://gis.utah.gov/data/cadastre/land-ownership/"><span style="font-weight: 400;">here.</span></a></span></p>
                </div>
            </div>
        </div>

                <!-- Panel - Download -->

                <div id="panelDownload" class="panel collapse">
                    <div id="headingDownload" class="panel-heading" role="tab">
                        <div class="panel-title">
                            <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseDownload" aria-expanded="true" aria-controls="collapseDownload"><span class="esri-icon-download" aria-hidden="true"></span><span class="panel-label">Download Data</span></a>
                            <a class="panel-close" role="button" data-toggle="collapse" tabindex="0" href="#panelDownload"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
                        </div>
                    </div>
                    <div id="collapseData" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingData">
                        <div class="panel-body">
                            <div id="topbar">
                                <p>Turn on the layers you wish to download. (Only the Wetland Mapping Layers are downloadable)</p>
                                <p><button class="action-button esri-icon-polygon" id="polygonButton" type="button"
                                  title="Draw polygon"></button> Click to draw a polygon over the area you would like to download.</p>
                                <p><button class="action-button esri-icon-down-arrow-circled" id="DownloadButton" type="button"
                                  title="Download"></button> Click to start the download of the area.</p>
                                <!-- <button class="action-button esri-icon-radio-unchecked" id="circleButton" type="button"
                                  title="Draw circle"></button> -->
                                <p><button class="action-button esri-icon-trash" id="resetBtn" type="button" title="Clear graphics"></button> Reset the selected polygon area.</p>
                              </div>
                        </div>
                    </div>
                </div>

        <!-- Panel - Disclaimer -->

        <div id="panelDisc" class="panel collapse">
            <div id="headingDisc" class="panel-heading" role="tab">
                <div class="panel-title">
                    <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseDisc" aria-expanded="true" aria-controls="collapseDisc"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span><span class="panel-label">Disclaimer</span></a>
                    <a class="panel-close" role="button" data-toggle="collapse" tabindex="0" href="#panelDisc"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
                </div>
            </div>
            <div id="collapseDisc" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingDisc">
                <div class="panel-body">
                    <p><strong>Disclaimer</strong></p>
                    <p><span>This product represents a compilation of information from both the Utah Geological Survey and external sources. The Utah Department of Natural Resources, Utah Geological Survey, makes no warranty, expressed or implied, regarding its suitability for a particular use. The Utah Department of Natural Resources, Utah Geological Survey, shall not be liable under any circumstances for any direct, indirect, special, incidental, or consequential damages with respect to claims by users of this product.</span></p>
<p><span>Wetlands spatial data were produced from a combination of aerial imagery examination and on-the-ground assessment and are not meant to be used as the basis for a jurisdictional wetland delineation. Wetlands across much of the state were mapped in the 1980s at a coarse resolution; some wetlands may have been inadvertently omitted and other wetlands may no longer exist or may not be considered jurisdictional. Please contact your local U.S. Army Corps of Engineers office if you are unsure of the status of a wetland on your property.</span></p>
<p><span>County-level data on species&rsquo; ranges were compiled from the Utah Conservation Data Center (2017) and the National Amphibian Atlas (U.S. Geological Survey, 2014); however, species may be found outside of the listed counties, elevation ranges, and habitat types.</span></p>
                </div>
            </div>
        </div>


        <!-- Panel - References -->

        <div id="panelRef" class="panel collapse">
            <div id="headingRef" class="panel-heading" role="tab">
                <div class="panel-title">
                    <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseRef" aria-expanded="true" aria-controls="collapseRef"><span class="esri-icon-group" aria-hidden="true"></span><span class="panel-label">References</span></a>
                    <a class="panel-close" role="button" data-toggle="collapse" tabindex="0" href="#panelRef"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
                </div>
            </div>
            <div id="collapseRef" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingRef">
                <div class="panel-body">
                    <p><strong>References</strong></p>
                    <p><span>AmphibiaWeb, 2018, AmphibiaWeb: Berkeley, California, University of California, online,</span><a href="https://amphibiaweb.org/"><span>https://amphibiaweb.org/</span></a><span>, accessed January 2018.</span></p>
<p><span>Green, D.M., Weir, L.A., Casper, G.S., and Lannoo, M., 2014, North American amphibians&minus; distribution and diversity: Berkeley, University of California Press, 600 p.</span></p>
<p><span>IUCN, 2017, The IUCN Red List of Threatened Species&minus;version 2017-3: online,</span><a href="http://www.iucnredlist.org"><span> http://www.iucnredlist.org</span></a><span>, accessed March 2018.</span></p>
<p><span>Menuz, 2015, Landscape integrity model for Utah&rsquo;s wetlands: Salt Lake City, Utah Geological Survey, 50 p., available </span><a href="https://geodata.geology.utah.gov/pages/search.php?search=!list15236&amp;order_by=date&amp;sort=DESC&amp;offset=0&amp;archive=0&amp;sort=DESC&amp;k="><span>online</span></a><span>. </span></p>
<p><span>Utah Conservation Data Center, 2017, Utah&rsquo;s state listed species by county: Online,</span><a href="https://dwrcdc.nr.utah.gov/ucdc/ViewReports/sslist.htm"><span>https://dwrcdc.nr.utah.gov/ucdc/ViewReports/sslist.htm</span></a><span>, accessed March 2018.</span></p>
<p><span>U.S. Fish and Wildlife Service (2009), A system for mapping riparian areas in the western United States: Arlington, 43 p.</span></p>
<p><span>U.S. Geological Survey, 2014, National amphibian atlas&minus;version number 3.0: Laurel, Maryland, Patuxent Wildlife Research Center: Online,</span><a href="http://www.pwrc.usgs.gov/naa"><span>www.pwrc.usgs.gov/naa</span></a><span>, accessed March 2018.</span></p>
                </div>
            </div>
        </div>


        <!-- Inventory Details panel -->
        <div id="panelInventory" class="panel collapse">
            <div id="headingInfo" class="panel-heading" role="tab">
                <div class="panel-title">
                    <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseInventory" aria-expanded="true" aria-controls="collapseInventory"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span><span class="panel-label">Well Inventory</span></a>
                    <a class="panel-close" role="button" data-toggle="collapse" data-target="#panelInventory"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
                </div>
            </div>
            <div id="collapseInventory" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingInventory">
                <div class="panel-body">

                    <div id="attInventory"></div>

                </div>
            </div>
        </div>

        <!-- Panel - Legend -->

        <div id="panelLegend" class="panel collapse in">
            <div id="headingLegend" class="panel-heading" role="tab">
                <div class="panel-title">
                    <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseLegend" aria-expanded="true" aria-controls="collapseLegend"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span><span class="panel-label">Legend</span></a>
                    <a class="panel-close" role="button" data-toggle="collapse" tabindex="0" href="#panelLegend"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
                </div>
            </div>
            <div id="collapseLegend" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingLegend">
                <div class="panel-body">
                    <div id="legendDiv"></div>
                </div>
            </div>
        </div>

        <!-- Panel - Layer List -->

        <div id="panelLayer" class="panel collapse">
            <div id="headingLayer" class="panel-heading" role="tab">
                <div class="panel-title">
                    <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseLayer" aria-expanded="false" aria-controls="collapseLayer"><span class="glyphicon glyphicon-list" aria-hidden="true"></span><span class="panel-label">Layer List</span></a>
                    <a class="panel-close" role="button" data-toggle="collapse" tabindex="0" href="#panelLayer"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
                </div>
            </div>
            <div id="collapseLayer" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingLayer">
                <div class="panel-body">
                    <div id="layerDiv"></div>
                </div>
            </div>
        </div>

        <!-- Basemaps Panel -->
        <div id="panelBasemaps" class="panel collapse">
            <div id="headingBasemaps" class="panel-heading" role="tab">
                <div class="panel-title">
                    <a class="panel-toggle collapsed" role="button" data-toggle="collapse" href="#collapseBasemaps" aria-expanded="false" aria-controls="collapseBasemaps"><span class="glyphicon glyphicon-th-large" aria-hidden="true"></span><span class="panel-label">Basemaps</span></a>
                    <a class="panel-close" role="button" data-toggle="collapse" data-target="#panelBasemaps"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
                </div>
            </div>
            <div id="collapseBasemaps" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingBasemaps">
                <div class="panel-body">
                    <div id="baseList"></div>
                   
                </div>
            </div>
        </div>

        <!-- Panel - Share -->
        <div id="panelShare" class="panel collapse">
            <div id="headingShare" class="panel-heading">
                <div class="panel-title">
                    <a class="panel-toggle collapsed" role="button" data-toggle="collapse" href="#collapseShare" aria-expanded="false" aria-controls="collapseShare"><span class="glyphicon glyphicon-share" aria-hidden="true"></span><span class="panel-label">Share</span></a>
                    <a class="panel-close" role="button" data-toggle="collapse" data-target="#panelShare"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
                </div>
            </div>
            <div id="collapseShare" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingShare">
                <div class="panel-body">
                    <iframe src="https://platform.twitter.com/widgets/tweet_button.html?size=l&url=https%3A%2F%2Fgeology.utah.gov&via=ugstwitter&related=twitterapi%2Ctwitter&text=Check%20out%20this%20great%20interactive%20map%20from%20the%20UGS&hashtags=utahgeologicalsurvey" width="140" height="28" title="Twitter Tweet Button" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>
                    <iframe src="https://www.facebook.com/plugins/share_button.php?href=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins%2F&layout=button_count&size=large&mobile_iframe=true&width=105&height=28&appId" width="105" height="28" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>
                    <p class="sharetext">Copy/paste the URL below to share this map via email, web browser, text editor, etc.</p>
                    <textarea class="textarea"> </textarea>
                </div>
            </div>
        </div>

    </div>

    <!-- /.calcite-panels -->

    <script type="text/javascript">
        var dojoConfig = {
            packages: [{
                    name: "bootstrap",
                    location: "https://esri.github.io/calcite-maps/dist/vendor/dojo-bootstrap"
                },
                {
                    name: "calcite-maps",
                    location: "https://esri.github.io/calcite-maps/dist/js/dojo"
                }
            ]
        };
    </script>

    <!-- ArcGIS JS 4 -->
    <script src="https://js.arcgis.com/4.17/"></script>

    <script>
        require([
            // ArcGIS
            "esri/Map",
            "esri/views/SceneView",
            // Widgets
            "esri/widgets/Home",
            "esri/widgets/Zoom",
            "esri/widgets/Compass",
            "esri/widgets/Search",
            "esri/widgets/Legend",
            "esri/widgets/BasemapToggle",
            "esri/layers/GroupLayer",
            "esri/widgets/Sketch/SketchViewModel",
            "esri/tasks/Geoprocessor",
            "esri/geometry/support/jsonUtils",
            "esri/renderers/support/jsonUtils",
            "esri/tasks/support/FeatureSet",
            "esri/tasks/support/JobInfo",
            "esri/widgets/ScaleBar",
            "esri/widgets/Locate",
            "esri/widgets/Attribution",
            "esri/layers/FeatureLayer",
            "esri/layers/MapImageLayer",
            "esri/layers/ImageryLayer",
            "esri/layers/GraphicsLayer",
            "esri/symbols/SimpleFillSymbol",
            "esri/Graphic",
            "esri/tasks/QueryTask",
            "esri/tasks/support/Query",
            "esri/tasks/support/RelationshipQuery",
            "esri/widgets/LayerList",
            "esri/widgets/NavigationToggle",
            "esri/core/watchUtils",
            "esri/widgets/BasemapGallery",
            "esri/widgets/BasemapGallery/support/LocalBasemapsSource",
            "esri/layers/ImageryLayer",
    "esri/layers/support/RasterFunction",
    "esri/Basemap",
            // Bootstrap
            "bootstrap/Collapse",
            "bootstrap/Dropdown",
            // Calcite Maps
            "calcite-maps/calcitemaps-v0.7",
            // Calcite Maps ArcGIS Support
            "calcite-maps/calcitemaps-arcgis-support-v0.7",
            "dojo/query",
            "dojo/domReady!"
        ], function(Map, SceneView, Home, Zoom, Compass, Search, Legend, BasemapToggle, GroupLayer, SketchViewModel, Geoprocessor, geometryJsonUtils, rendererJsonUtils, FeatureSet, JobInfo, ScaleBar, Locate, Attribution, FeatureLayer, MapImageLayer, ImageryLayer, GraphicsLayer, SimpleFillSymbol, Graphic, QueryTask, Query, RelationshipQuery,
            LayerList, NavigationToggle, watchUtils, BasemapGallery, LocalBasemapsSource, ImageryLayer, RasterFunction, Basemap, Collapse, Dropdown, CalciteMaps, CalciteMapArcGISSupport, query) {



            /******************************************************************
             *
             * Create the map, view and widgets
             *
             ******************************************************************/

             var gpUrl =
             "https://webmaps.geology.utah.gov/arcgis/rest/services/Wetlands/WetlandsDownload/GPServer/ExtractWetlandsData";
                //"https://webmaps.geology.utah.gov/arcgis/rest/services/Wetlands/WetlandExtractTask/GPServer/ExtractWetlands";


            var tempGraphic = null;          
            let editGraphic;
            // GraphicsLayer to hold graphics created via sketch view model
            const tempGraphicsLayer = new GraphicsLayer({
                listMode: "hide",
            });
            // Map
            var map = new Map({
                basemap: "hybrid",
                ground: "world-elevation",
            });

            // View
            var mapView = new SceneView({
                container: "mapViewDiv",
                map: map,
                center: [-112, 40.7],
                zoom: 11,
                padding: {
                    top: 50,
                    bottom: 0
                },
                ui: {
                    components: []
                }
            });
            // Popup and panel sync
            // mapView.when(function(){
            //   CalciteMapArcGISSupport.setPopupPanelSync(mapView);
            // });
            // Search - add to navbar
            var searchWidget = new Search({
                container: "searchWidgetDiv",
                view: mapView
            });
            CalciteMapArcGISSupport.setSearchExpandEvents(searchWidget);
            // Map widgets
            var home = new Home({
                view: mapView
            });
            mapView.ui.add(home, "top-left");
            var zoom = new Zoom({
                view: mapView
            });
            mapView.ui.add(zoom, "top-left");
            var compass = new Compass({
                view: mapView
            });
            mapView.ui.add(compass, "top-left");

            // var basemapToggle = new BasemapToggle({
            //     view: mapView,
            //     secondBasemap: "satellite"
            // });
            // geolocate user position
            var locate = new Locate({
                view: mapView
            });

            // // Panel widgets - add legend
            // var legend = new Legend({
            //   container: "legendDiv",
            //   view: mapView
            // });



            var navigationToggle = new NavigationToggle({
                view: mapView
            });
            mapView.ui.add(navigationToggle, "top-left");

            mapView.map.add(tempGraphicsLayer);


            //--------custom basemap--------

            var serviceRFT = new RasterFunction({
        functionName: "FalseColorComposite",
        variableName: "Raster"
      });

      var IRlayer = new ImageryLayer({
        url: "https://utility.arcgis.com/usrsvcs/servers/0d7e1a9daec346eb9315cba948467b46/rest/services/NAIP/ImageServer",
        renderingRule: serviceRFT
      });

      var irBase = new Basemap({
        baseLayers: [IRlayer],
        title: "False Color Comp from NAIP",
        id: "irBase",
        thumbnailUrl: "https://geology.utah.gov/apps/jay/irThumb.PNG"
      });

      let baseSource = new LocalBasemapsSource({
          basemaps: [Basemap.fromId("hybrid"), Basemap.fromId("streets"), Basemap.fromId("gray"), irBase]
      });


      var basemapGallery = new BasemapGallery({
        view: mapView,
        container: baseList,
        source: baseSource
      });



            //Create popup content
            contentPro = function(feature) {
                console.log(feature);
                var contentPro = "";

                
                    if (feature.graphic.attributes.IMAGE_YR) {
                        contentPro += "<span class='bold' title='Image Year'><b>Image Year: </b></span>{IMAGE_YR}<br/>";
                    }
                
            
                    if (feature.graphic.attributes.IMAGE_DATE) {
                        contentPro += "<span class='bold' title='Image Year'><b>Image Date: </b></span>{IMAGE_DATE}<br/>";
                    }
                
                
                    if (feature.graphic.attributes.Decade) {
                        contentPro += "<span class='bold' title='Image Year'><b>Decade: </b></span>{Decade}<br/>";
                    }
            
              
                    if (feature.graphic.attributes.IMAGE_SCALE) {
                        contentPro += "<span class='bold' title='Image Year'><b>Image Scale: </b></span>{IMAGE_SCALE}<br/>";
                    }
            
                
                    if (feature.graphic.attributes.Modifier) {
                        contentPro += "<span class='bold' title='Image Year'><b>Data Category: </b></span>{DATA_CAT}<br/>";
                    }
                
                
                    if (feature.graphic.attributes.SUPPMAPINFO) {
                        contentPro += "<span class='bold'><b>Supplemental Map Info: </b></span>" + "<a href='{SUPPMAPINFO}' target='_blank'>Opens in new tab</a>";
                    } else  {
                        contentPro += "<span class='bold'><b>Supplemental Map Info: </b></span>Supplemental Map Info not currently available.";
                    }
                
                return contentPro;
            }

            contentRipMeta = function(feature) {
                console.log("Rip Meta");
                var contentPro = "";

                
                    if (feature.graphic.attributes.IMAGE_YR) {
                        contentPro += "<span class='bold' title='Image Year'><b>Image Year: </b></span>{IMAGE_YR}<br/>";
                    }
                
               
                    if (feature.graphic.attributes.IMAGE_DATE) {
                        contentPro += "<span class='bold' title='Image Year'><b>Image Date: </b></span>{IMAGE_DATE}<br/>";
                    }
                
                
                    if (feature.graphic.attributes.Decade) {
                        contentPro += "<span class='bold' title='Image Year'><b>Decade: </b></span>{Decade}<br/>";
                    }
                
                
                    if (feature.graphic.attributes.IMAGE_SCALE) {
                        contentPro += "<span class='bold' title='Image Year'><b>Image Scale: </b></span>{IMAGE_SCALE}<br/>";
                    }
                
                
                    if (feature.graphic.attributes.DATA_SOURCE) {
                        contentPro += "<span class='bold' title='Image Year'><b>Data Source: </b></span>{DATA_SOURCE}<br/>";
                    }
                

                
                    if (feature.graphic.attributes.SUPPMAPINFO) {
                        contentPro += "<span class='bold'><b>Supplemental Map Info: </b></span>" + "<a href='{SUPPMAPINFO}' target='_blank'>Opens in new tab</a>";
                    } else {
                        contentPro += "<span class='bold'><b>Supplemental Map Info: </b></span>Supplemental Map Info not currently available.";
                    }
                
                return contentPro;
            }

            contentType = function(feature) {
                var contentType = "";

                
                    if (feature.graphic.attributes.ATTRIBUTE) {
                        contentType += "<span class='bold' title='NWI Code'><b>Attribute: </b></span>{ATTRIBUTE}<br/>";
                    }
                
                
                    if (feature.graphic.attributes.WETLAND_TYPE) {
                        contentType += "<span class='bold' title='Utah Type'><b>Wetland Type: </b></span>{WETLAND_TYPE}<br/>";
                    }
                
                
                    if (feature.graphic.attributes.ACRES) {
                        var acresShort = feature.graphic.attributes.ACRES.toFixed(2); 
                        contentType += "<span class='bold' title='Acres'><b>Acres: </b></span>" + acresShort + "<br/>";
                    }
                
               
                    if (feature.graphic.attributes.System) {
                        contentType += "<span class='bold' title='Utah Modification'><b>System: </b></span>{System}<br/>";
                    }
                
                
                    if (feature.graphic.attributes.Class) {
                        contentType += "<span class='bold' title='Utah Use'><b>Class: </b></span>{Class}<br/>";
                    }
                
                
                    if (feature.graphic.attributes.Regime) {
                        contentType += "<span class='bold' title='Utah Use'><b>Regime: </b></span>{Regime}<br/>";
                    }
                
                
                    if (feature.graphic.attributes.Modifier) {
                        contentType += "<span class='bold' title='Utah Use'><b>Modifier: </b></span>{Modifier}<br/>";
                    }
                
                return contentType;

            }

            contentRipType = function(feature) {
                console.log(feature);
                var contentType = "";

                
                    if (feature.graphic.attributes.ATTRIBUTE) {
                        contentType += "<span class='bold' title='NWI Code'><b>Attribute: </b></span>{ATTRIBUTE}<br/>";
                    }
                
                
                    if (feature.graphic.attributes.WETLAND_TYPE) {
                        contentType += "<span class='bold' title='Utah Type'><b>Riparian Type: </b></span>{WETLAND_TYPE}<br/>";
                    }
                
                
                    if (feature.graphic.attributes.ACRES) {
                        var acresShort = feature.graphic.attributes.ACRES.toFixed(2); 
                        contentType += "<span class='bold' title='Acres'><b>Acres: </b></span>" + acresShort + "<br/>";
                    }
                
                
                    if (feature.graphic.attributes.Description) {
                        contentType += "<span class='bold' title='Utah Modification'><b>Description: </b></span>{Description}<br/>";
                    }
                
               
                    if (feature.graphic.attributes.System) {
                        contentType += "<span class='bold' title='Utah Use'><b>System: </b></span>{System}<br/>";
                    }
                
               
                    if (feature.graphic.attributes.Class) {
                        contentType += "<span class='bold' title='Utah Use'><b>Class: </b></span>{Class}<br/>";
                    }
                
                
                    if (feature.graphic.attributes.DominanceType) {
                        contentType += "<span class='bold' title='Utah Use'><b>Dominance Type: </b></span>{DominanceType}<br/>";
                    }
                

                return contentType;

            }


            contentStudyArea = function(feature) {
                var contentStudyArea = "";

                if (feature.graphic.attributes.region) {
                    contentStudyArea += "<span class='bold' title='Region'><b>Region: </b></span>{region}<br/>";
                }
                if (feature.graphic.attributes.years) {
                    contentStudyArea += "<span class='bold' title='Years'><b>Years: </b></span>{years}<br/>";
                }
                
                    if (feature.graphic.attributes.ProjectReport){
                    contentStudyArea += "<span class='bold'><b>Project Report: </b></span>" + "<a href='{ProjectReport}' target='_blank'>Opens in new tab</a>";
                    } else  {
                    contentStudyArea += "<span class='bold'><b>Project Report: </b></span>Currently not available.";
                }
                

                return contentStudyArea;

            }

            //             contentOwnership = function(value, key, data) {
            //     var contentOwnership = "";

            //     if (key === "STATE_LGD") {
            //         contentOwnership += "<span class='bold' title='Owner'><b>Owner: </b></span>{STATE_LGD}<br/>";
            //     }
            //     // if (key === "TRIBE") {
            //     //     contentOwnership += "<span class='bold' title='TRIBE'><b>Tribe: </b></span>{TRIBE}<br/>";
            //     // }
            //     // if (key === "ProjectReport") {
            //     //     if (data.ProjectReport){
            //     //         contentOwnership += "<span class='bold'><b>Project Report: </b></span>" + "<a href='{ProjectReport}' target='_blank'>Opens in new tab</a>";
            //     //     } else  {
            //     //         contentOwnership += "<span class='bold'><b>Project Report: </b></span>Currently not available.";
            //     // }
            //     // }

            //     return contentOwnership;

            // }


            contentSpecies = function(feature) {
                console.log(feature);
                var contentSpecies = "";

                objectID = feature.graphic.attributes.OBJECTID;

                var queryTask = new QueryTask({
                    url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Wetlands/Wetland_Dependent_Species/MapServer/1"
                });

                var relationQuery = new RelationshipQuery({
                    objectIds: [objectID],
                    outFields: ["OBJECTID", "Species", "Notes", "Status", "Known_elevation_range", "Habitat_Description", "Link_to_More_Information"],
                    //returnGeometry: true,
                    relationshipId: 0
                });

                //var idArray = [];

                queryTask.executeRelationshipQuery(relationQuery)
                    .then(function(rslts) {
                        console.log(rslts);
                        var features = rslts[objectID].features;
                        features.forEach(function(ftr) {
                            var t = ftr.attributes;
                            var species = t.Species;
                            contentSpecies += "<span class='bold' title='Species'><b><font size='3'><span class='uppercase'>" + species + "</span></font></b></span><br>";
                            var range = t.Known_elevation_range;
                            contentSpecies += "<span class='bold' title='Notes'><b>Known Elevation Range: </b></span>" + range + "<br/>";
                            var habitat = t.Habitat_Description;
                            contentSpecies += "<span class='bold' title='Status'><b>Habitat: </b></span>" + habitat + "<br/>";
                            // var notes = t.Notes;
                            // contentSpecies += "<span class='bold' title='Notes'><b>Notes: </b></span>" + notes + "<br/>";
                            // var status = t.Status;
                            // contentSpecies += "<span class='bold' title='Status'><b>Status: </b></span>" + status + "<br/>";
                            var url = t.Link_to_More_Information;
                            contentSpecies += "<span class='bold' id='more' title='Status'><b>More Info: </b></span> <a target='_blank' href='" + url + "'>Link</a><br/><br>";
                            //idArray.push(t.OBJECTID);

                        });

                        console.log(contentSpecies);


                        var thetitle = contentTitle(feature);

                        mapView.popup.open({
                            title: "Sensitive Amphibian Species " + thetitle,
                            content: contentSpecies,
                            outFields: ["*"]
                        });
                        //});

                        //});

                    })

            }


            contentTitle = function(feature) {
                console.log(feature);
                var contentTitle = "";
                var titleName = feature.graphic.attributes.NAME;
                contentTitle += "for " + titleName + " County";
                return contentTitle
            }




            //Add data
            var boundaryLayer = new MapImageLayer({
                url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Wetlands/Boundaries/MapServer",
                sublayers: [{
                        id: 1,
                        title: "River Basins",
                        visible: true,
                        labelsVisible: true,
                        labelingInfo: [{
                            labelExpression: "[Name]",
                            labelPlacement: "always-horizontal",
                            symbol: {
                                type: "text", // autocasts as new TextSymbol()
                                color: [0, 92, 230],
                                haloColor: [255, 255, 255],
                                haloSize: 1,
                                font: {
                                    size: 12,
                                    weight: "bold",
                                    style: "italic"
                                }
                            },
                            // minScale: 2400000,
                            maxScale: 1500001,
                        }]
                    },
                    //maxScale: 1500001,
                    {
                        id: 2,
                        title: "River Sub Basins",
                        visible: true,
                        minScale: 1500000,

                    }
                ]
            });


            var wetlandLayer = new MapImageLayer({
                url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Wetlands/Wetland_Mapping/MapServer",
				title: "Wetland Mapping",
                sublayers: [{
                        id: 4,
                        title: "Wetlands Outline",
                        visible: false,
                        popupTemplate: {
                            title: "Wetland Outlines",
                            content: contentType,
                            outFields: ["*"]
                        },
                    },
                    {
                        id: 3,
                        title: "Riverine",
                        visible: false,
                        popupTemplate: {
                            title: "Riverine",
                            content: contentType,
                            outFields: ["*"]
                        },

                    },
                    {
                        id: 2,
                        title: "Wetlands (non-riverine)",
                        visible: true,
                        popupTemplate: {
                            title: "Wetlands (non-riverine)",
                            content: contentType,
                            outFields: ["*"]
                        },
                        popupEnabled: true
                    },
                    {
                        id: 1,
                        title: "Wetland Metadata",
                        visible: false,
                        popupTemplate: {
                            title: "Wetland Metadata",
                            content: contentPro,
                            outFields: ["*"]
                        },
                        popupEnabled: true
                    },

                ]
            });

            var speciesLayer = new MapImageLayer({
                url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Wetlands/Wetland_Dependent_Species/MapServer",
                visible: false,
                sublayers: [{
                        id: 1,
                        title: "Sensitive amphibian species ",
                        //visible: false,
                        popupTemplate: {
                            title: "Sensitive Amphibian Species {NAME:contentTitle}",
                            content: contentSpecies,
                            outFields: ["*"]

                        },
                    }

                ]
            });

            var conditionsLayer = new MapImageLayer({
                url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Wetlands/Wetland_Condition/MapServer",
                visible: false,
                sublayers: [{
                        id: 2,
                        title: "Wetland Stressors",
                        opacity: 0.6,
                        //visible: false,

                    },
                    {
                        id: 1,
                        title: "Wetland Assessment Projects",
                        opacity: 0.6,
                        popupTemplate: {
                            title: "Wetland Assessment Projects",
                            content: contentStudyArea,
                            outFields: ["*"]
                        },
                        //visible: false
                    },
                ]
            });

            var ownershipLayer = new MapImageLayer({
                url: "https://gis.trustlands.utah.gov/server/rest/services/Ownership/UT_SITLA_Ownership_LandOwnership_WM/MapServer",
                visible: false,
                title: "Land Ownership",
                popupTemplate: {
                            title: "Land Ownership",
                           // content: contentOwnership
                        },
                //opacity: 0.6,
            });

            var hydricSoils = new ImageryLayer ({
                url: "https://utility.arcgis.com/usrsvcs/servers/1d5e9da46b4b4d9195cdd173586c5eb7/rest/services/USA_Soils_Hydric_Class/ImageServer",
                title: "Hydric Soils Classes",
                visible: false
            })

            var riparianData = new MapImageLayer ({
                url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Wetlands/Wetland_Riparian/MapServer",
                title: "Riparian Mapping",
                visible: false,
                sublayers: [{
                        id: 0,
                        title: "Riparian Metadata",
                        popupTemplate: {
                            title: "Riparian Metadata",
                            content: contentRipMeta,
                            outFields: ["*"]
                        },
                    },
                    {
                        id: 1,
                        title: "Riparian",
                        popupTemplate: {
                            title: "Riparian Areas",
                            content: contentRipType,
                            outFields: ["*"]
                        },
                    },
                    ]
            })

            var wetlandGroup = new GroupLayer ({
                title: "Wetland and Riparian Mapping",
                visible: true,
                visibiltyMode: "independent",
                layers: [riparianData, wetlandLayer]
            })

            


            mapView.map.add(ownershipLayer);
            mapView.map.add(speciesLayer);
            mapView.map.add(conditionsLayer);
            mapView.map.add(hydricSoils);
            mapView.map.add(wetlandGroup);
            //mapView.map.add(wetlandLayer);
            mapView.map.add(boundaryLayer);
            

            ownershipLayer.opacity = .6;
            hydricSoils.opacity = .7;



            mapView.popup.watch(["selectedFeature"], function(g) {
                // event is the event handle returned after the event fires.
                mapView.graphics.remove(tempGraphic);

                if (g) {

                    // var symbol = new SimpleFillSymbol({
                    //     type: "simple-fill",
                    //     style: "none",
                    //     outline: { // autocasts as new SimpleLineSymbol()
                    //         color: "cyan",
                    //         width: 3
                    //     }
                    // });

                    var symbol = {
                        type: "simple-fill",
                        style: "none",
                        outline: { // autocasts as new SimpleLineSymbol()
                            color: "cyan",
                            width: 3
                        }
                    };

                    tempGraphic = new Graphic({
                        geometry: g.geometry,
                        symbol: symbol
                    });
                    mapView.graphics.add(tempGraphic);

                }
            });
 
            // var legend = new Legend({
            //   view: mapView,
            //   container: "legendDiv"
            // });

            layerList = new LayerList({
                view: mapView,
                container: "legendDiv",
                listItemCreatedFunction: function(event) {
                    const item = event.item;
                    item.panel = {
                        content: "legend",
                        //open: true
                    };
                    item.actionsSections = [
                        [{
                            title: "Increase opacity",
                            className: "esri-icon-up",
                            id: "increase-opacity"
                        }, {
                            title: "Decrease opacity",
                            className: "esri-icon-down",
                            id: "decrease-opacity"
                        }]
                    ];
                }
            });

            //Event listener that fires each time an action is triggered
            layerList.on("trigger-action", function(event) {

                // Capture the action id.
                var id = event.action.id;

                var title = event.item.title;

                if (title === "Wetland and Riparian Mapping") {
                    layer = wetlandLayer;
                } else if (title === "Boundaries") {
                    layer = boundaryLayer;
                } else if (title === "Wetland Dependent Species") {
                    layer = speciesLayer;
                } else {
                    layer = hydricSoils;
                }



                if (id === "increase-opacity") {
console.log("increase opacity");
                    // if the increase-opacity action is triggered, then
                    // increase the opacity of the GroupLayer by 0.25

                    if (layer.opacity < 1) {
                        layer.opacity += 0.1;
                    }
                } else if (id === "decrease-opacity") {
                    console.log("decrease opacity");
                    // if the decrease-opacity action is triggered, then
                    // decrease the opacity of the GroupLayer by 0.25

                    if (layer.opacity > 0) {
                        layer.opacity -= 0.1;
                    }
                }
            });

            //load download geoprocessor
            var gp = new Geoprocessor(gpUrl);
                gp.outSpatialReference = { // autocasts as new SpatialReference()
                wkid: 102100
            };

// SketchView functions
            mapView.when(function() {
                    // create a new sketch view model
                    const sketchViewModel = new SketchViewModel({
                    view: mapView,
                    layer: tempGraphicsLayer,
                     polygonSymbol: {
                      type: "simple-fill", // autocasts as new SimpleFillSymbol()
                      color: "rgba(138,43,226, 0.8)",
                      style: "solid",
                       outline: {
                         color: "white",
                       width: 1
                      }
                     }
                 });

                         setUpClickHandler();

// Listen to create-complete event to add a newly created graphic to view
sketchViewModel.on("create-complete", addGraphic);

// Listen the sketchViewModel's update-complete and update-cancel events
sketchViewModel.on("update-complete", updateGraphic);
sketchViewModel.on("update-cancel", updateGraphic);

//*************************************************************
// called when sketchViewModel's create-complete event is fired.
//*************************************************************
function addGraphic(event) {
  // Create a new graphic and set its geometry to
  // `create-complete` event geometry.
  graphic = new Graphic({
    geometry: event.geometry,
    symbol: sketchViewModel.graphic.symbol
  });
  console.log(graphic);
  tempGraphicsLayer.add(graphic);
}

//***************************************************************
// called when sketchViewModel's update-complete or update-cancel
// events are fired.
//*************************************************************
function updateGraphic(event) {
  // event.graphic is the graphic that user clicked on and its geometry
  // has not been changed. Update its geometry and add it to the layer
  event.graphic.geometry = event.geometry;
  tempGraphicsLayer.add(event.graphic);

  // set the editGraphic to null update is complete or cancelled.
  editGraphic = null;
}

// ************************************************************************************
// set up logic to handle geometry update and reflect the update on "tempGraphicsLayer"
// ************************************************************************************
function setUpClickHandler() {
  mapView.on("click", function(event) {
    mapView.hitTest(event).then(function(response) {
      var results = response.results;
      // Found a valid graphic
      if (results.length && results[results.length - 1]
        .graphic) {
        // Check if we're already editing a graphic
        if (!editGraphic) {
          // Save a reference to the graphic we intend to update
          editGraphic = results[results.length - 1].graphic;
          // Remove the graphic from the GraphicsLayer
          // Sketch will handle displaying the graphic while being updated
          tempGraphicsLayer.remove(editGraphic);
          sketchViewModel.update(editGraphic);
        }
      }
    });
  });
}


//***************************************
// activate the sketch to create a polygon
//***************************************
var drawPolygonButton = document.getElementById("polygonButton");
drawPolygonButton.onclick = function() {
  // set the sketch to create a polygon geometry
  sketchViewModel.create("polygon");
  setActiveButton(this);
};


//***************************************
// activate the GP Download
//***************************************
var downloadButton = document.getElementById("DownloadButton");
downloadButton.onclick = function() {
  // set the sketch to create a polygon geometry
  //sketchViewModel.create("polygon");
  var inputGraphicContainer = [];
          inputGraphicContainer.push(graphic);
          var featureSet = new FeatureSet();
          featureSet.features = inputGraphicContainer;
          console.log(inputGraphicContainer);
          console.log(featureSet);
  console.log(graphic);
  var params = {
            "Area_of_Interest": featureSet,
          };

               gp.submitJob(params).then(poop);             

            function poop(rslt){
                console.log(rslt);
                //window.open("https://webmaps.geology.utah.gov/arcgis/rest/directories/arcgisjobs/wetlands/wetlandextracttask_gpserver/" + rslt.jobId + "/scratch/output.zip", "_blank");
                var test1 = "https://webmaps.geology.utah.gov/arcgis/rest/directories/arcgisjobs/wetlands/wetlandsdownload_gpserver/" + rslt.jobId + "/scratch/wetlands_download.zip";
                //window.open(test1, '_blank')
                //alert("Download '<a href='" + test1 + "' target='_blank'>Data</a>'")


var downloadFrame = document.createElement("iframe"); 
console.log(downloadFrame);
downloadFrame.setAttribute('src',test1);
downloadFrame.setAttribute('class',"screenReaderText"); 
document.body.appendChild(downloadFrame);

                console.log(test1);
               }
};







//**************
// reset button
//**************
document.getElementById("resetBtn").onclick = function() {
  sketchViewModel.reset();
  tempGraphicsLayer.removeAll();
  setActiveButton();
};

function setActiveButton(selectedButton) {
  // focus the view to activate keyboard shortcuts for sketching
  mapView.focus();
  var elements = document.getElementsByClassName("active");
  for (var i = 0; i < elements.length; i++) {
    elements[i].classList.remove("active");
  }
  if (selectedButton) {
    selectedButton.classList.add("active");
  }
}
});



            // geolocate user position
            query(".dropdown-menu").on("click", function(e) {
                if (e.target.text == " Locate") {
                    locate.locate().then(function() {
                        // do we want to add a note to user?
                        if (query(".calcite-dropdown.open")[0]) {
                            query(".calcite-dropdown, .calcite-dropdown-toggle").removeClass("open");
                        } // end if
                    }) // end .then
                } // end if
            }); // end query


            // share button controls
            query(".dropdown-menu").on("click", function(e) {

                if (e.target.text == " Share") {
                    var appUri = window.location.href;
                    var params = viewToURL();
                    var txt = appUri + "?mview=map" + params;
                    console.log(txt);
                    // $(".textarea").text(txt);
                    document.querySelector("textArea").innerHTML += txt;

                }
            });

            // Save the map state to URL so switching between map & scene saves the view
            function viewToURL() {;
                state = "&center=" + mapView.center.longitude.toFixed(5) + "," + mapView.center.latitude.toFixed(5);
                state += "&scale=" + mapView.scale.toFixed(0);
                state += "&basemap=" + mapView.map.basemap.id;
                var openpanels = query(".panel-collapse.in"); // get id of any open panel bodies
                if (openpanels[0]) {
                    tate += "&panels=" + openpanels[0].id; // store in url. ex. collapseLegend
                }
                return state;
            }

            // Basemap events
            query("#selectBasemapPanel").on("change", function(e) {
                // if (e.target.value == "ustopo") {
                //     // setup the ustopo basemap global variable.
                //     var ustopo = new Basemap({
                //         baseLayers: new TileLayer({
                //             url: "https://server.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer"
                //         }),
                //         title: "usTopographic",
                //         id: "ustopo"
                //     });
                //     mapView.map.basemap = ustopo;
                // } else 
                if (e.target.value == "Infrared") {

mapView.map.basemap = irBase;
                    // if mapview use basemaps defined in the value-vector=, but if mapview use value=
                } else if (map.mview == "map") {
                    mapView.map.basemap = e.target.options[e.target.selectedIndex].dataset.vector;
                } else { // =="scene"
                    mapView.map.basemap = e.target.value;
                }
            });

            


        });
    </script>

</body>

</html>